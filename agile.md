# アジャイルソフトウェア開発の奥義

# アジャイルプラクティス
従来のウォーターフォール型開発では、良いプラクティス(実践法)を設けずにプロジェクトを進めたことで、プロジェクトが上手く行かないことが多かった。

## 1.1 アジャイルアライアンス
開発チームが迅速に作業し、変化に対応できるようにするために業界のエキスパートが集まり、アジャイルアライアンス宣言をまとめた。


### 1.1.1 アジャイルアライアンス宣言

#### アジャイルソフトウェア開発宣言
```
プロセスやツールよりも、人と人同士の交流を
包括的なドキュメントよりも、動作するソフトウェアを
契約上の交渉よりも、顧客との協調を
計画に従うことよりも、変化に対応することを
```


#### プロセスやツールよりも、人と人同士の交流を重視する
- 成功の鍵を握る最も重要な要素は `人` である。
- 開発環境の構築よりも先に、開発チームを形成することの方が先決。
- ツールは、チームに選択させる。
- ツールはまずは無料のもので始め、不満が出てきたら有料ツールも視野に
- プロセスが良くないと、人材の力を無駄にしてしまうが、優秀な人材がいなければプロジェクトは失敗する。
- 仲間と上手くやっていける能力は、プログラミング能力よりも重要


#### 包括的なドキュメントよりも、動作するソフトウェアを重視する
ドキュメントがあったほうが良いが、コードとの整合性を保つためのコストがかかるため膨大なドキュメントは必要ない。

##### ドキュメントは以下のように簡潔で、要を得たものでなければならない。
- 12 ~ 24 ページ程度のボリューム
- システム設計については、論理的説明に留める
- システム構造については、トップレベルについてのみ記述する

##### 簡潔なドキュメントしかない状況で、新人メンバーに仕事を教えるには？

- 先輩が新人のすぐ隣に座って仕事をして、手助けしながら知識を伝える
- 親密なトレーニングと交流を通して、新人はチームに溶け込んでいく

#### 契約上の交渉よりも、顧客との協調を重視する
システムは顧客からの頻繁なフィードバックにより、常に進化する必要があるため、プロジェクトのコストや納期などの条件を前もって契約書で定めることは不可能。

最良の契約書とは、開発チームと顧客が協調する方法を示したもの

##### プロジェクトケース1
- コード規模は５０万行で数年がかりのプロジェクト
- 開発チームへの月々の支払いは比較的安いが、機能ブロックを収めるごとに高いボーナスが支払われる仕組み
- 契約書には `機能ブロック` の具体的な内容は明記せず、 `顧客の受け入れテストをパスしたブロックにつきボーナスを支払う` という条件を記した。
- 受け入れテストの詳細も契約書に特に規定していない
- ソフトウェアのリリースは毎週行われる
- 毎週、顧客がソフトウェアに組み込む変更点のリストを携えてくる
- 顧客と一緒に変更点に優先順位をつけ、スケジュールを組む。

##### 得られたメリット
- 顧客と緊密にしていたので、受け入れテストが問題になることはなかった
- 顧客は作業中ブロックの進捗を把握することできた
- 顧客との信頼関係を構築できた
- コストや納期を厳密に決める契約書ではなく、相互の協調関係について取り決めた契約書を用意したことで、柔軟に取り組むことができた
- 機能ブロックの追加や削除を柔軟に行うことで、変化の激しい仕様変更でも破綻することなく、上手くプロジェクトが回った

#### 計画に従うことよりも、変化に対応することを重視する


##### ソフトウェア開発プロジェクトにおいて、遠い将来の予定を立てる意味がない理由
- ビジネスの状況は変わりやすく、その変化によって要求そのものも当然変わる
- 顧客は、実際に動くシステムを触ってみると、要求を変更することが多い
- ガンとトチャートを作って、日程管理しても、チャートの形自体が変更されることが多いため

##### 上手な計画の立て方
- 詳細な予定は、２週間分だけにしておく
- 次の２週間の間にすべきことは、具体的に知っておく必要
- おおまかな計画は３ヶ月分だけ作る
- 次の３ヶ月に、どういった要求に対応することになるかは、おおまかに把握
- １年後は、システムがどんな形にになっているか漠然とした方向さえ分かれば良い


## 1.2 原則
以上の`4つの価値`から、次に示す`12の原則`が導き出された。これらは従来型のプロセスとアジャイルプラクティスの違いを明確にするもの

### 最優先事項は顧客を満足させることであり、価値あるソフトウェアを早い段階から継続的に届けることで、これを実現する
MIT Sloan Management Reveiw という調査結果によると、

`早い段階から頻繁に納品すればするほど、最終的な品質はより高いものになる`

#### アジャイルプラクティス
- 早い段階から頻繁に納品する。
- プロジェクト開始後、数週間以内に基本的なシステムを納品
- その後も２週間ごとに機能追加しながら納品を目指す
- 顧客は、機能が十分だと思えば組み込みを承諾し、そうでなければフィードバックしてくれる


### 要求変更を歓迎し、たとえ開発の後半であってもそれを受け入れる。アジャイルプロセスは、変化に対応することで顧客の競争上の優位性を確保する

#### 開発チームの姿勢
- 変化を恐れず、むしろ変更要求を歓迎する
- こうした変更によって、開発チームは市場が求めていることをより深く学ぶことになる。
- 開発チームは、ソフトウェアの構造を柔軟に保つ最善の努力をする
- そうすることで要求変更があっても、その影響を最小限に抑えることができる

### 実現可能なソフトウェアの納品を頻繁に行う。できるだけ短い期間で納品することを旨とし、数週間から数ヶ月間隔で納品する


### 顧客と開発者はプロジェクト全般を通じて日々ともに働かなければならない
ソフトウェアプロジェクトは、納品すれば終わりではなく、継続的に面倒を見ていかなければならない

### やる気のある開発者をプロジェクトの中心に据え、彼らが必要とする環境とサポートを与え、信頼して仕事の完遂を任せる


#### プロジェクトの成否要素
1次的要素の力が最大限発揮されるように2次的要素が最適化する
- 1次的要素 =  `人`
- 2次的要素 = `プロセス、環境、管理`


### 開発チームで情報を伝達する最も効果的な方法は、直接話し合うことである
- アジャイルプロジェクトでは、基本的に会話がメインコミュニケーション
- ドキュメントを作ることはあるが、プロジェクトの一部始終を記載したりしない
- チームは仕様、計画、設計を書面に求めないので、基本ドキュメント作成しない
- 重要だと判断した場合にのみ、ドキュメント作成する


### 実働するソフトウェアこそが進捗の尺度である
進捗尺度の唯一の指標は、実働性。30%完成しているとは、必要な機能の30%が稼働していなければならない。


### 持続できるペースで開発する。そうすればスポンサーも開発者もユーザーもずっと一定のペースを確保できる

- 飛ばしすぎると途中で燃え尽きたり手を抜いたりして大失敗することになる
- ペースを守り、無理をしないこと
- 明日できることを今日無理やりやらないこと
- プロジェクト期間中、ずっと最高の品質を保てるペースで仕事を進めること

### 高度な水準と優れた設計への配慮は、アジャイル性を高める
- 開発スピードを保つ鍵は、 `品質`
- プロジェクトの進行を早くさせたければ、ソフトウェアを可能な限り無駄のないしっかりしたものにしていかなければならない
- そのためにチームは常に高品質なコードを書くようベストを尽くすべき
- 乱雑なコードを後で時間のあるときに書きなおそうとは思わないこと
- その日のうちに書き直すことが重要


### シンプルさが肝心。やらなくてはいいことはしない
- いきなりシステム全体を作り上げない
- 目的にかなう最もシンプルな方法で段階的に導入していく
- 明日発生するかもしれない問題を予測したり、それに対して前もって対処することにはあまり意味がない
- 今日必要な作業をできるだけシンプルに高い質で行う
- そうすれば明日問題が発生しても柔軟に対処可能

### 最高のアーキテクチャ、仕様要求、設計は自己管理能力のあるチームから生まれる
- 外部から要求される `責務` はチームの個人にではなく、チーム全体に伝えられ、チーム一丸となってその責務を果たす最善策を探し出す
- メンバーの一個人が、責任を負うことはない
- 責任はチーム全体に、つまりメンバー一人一人にある


### チームは定期的にプロジェクトを見直し、より効果的な方法を考え、対応方法の変更や調整を行う
- 組織や規則、慣例などを常に見直す。環境は常に変化しており、それに合わせて変化していかなければアジャイル性を保てないことを認識する

## 1.3 結論
- プロの開発者のゴールは、可能な限り高品質の製品を雇い主や顧客に納品すること
- プロジェクトが上手くいかない理由として、良かれと思ってプロセスを肥大化させてしまっていることが多い。

### アジャイルソフトウェア開発の価値と原則とは？
プロセスが雪だるま式に肥大化してしまう悪循環を断ち切り、シンプルなテクニックに焦点を絞り込むことで本来の目標を達成できるように生み出された方式


# エクストリームプログラミングの概要
前章では、アジャイルソフトウェア開発の概要を説明したが、実際にどうすれば良いか、具体的な実践方法を本章で示していく


## 2.1 エクストリームプログラミングの実践

#### XPとは
- 最も有名なアジャイルメソッドの一つ
- 複数のシンプルなプラクティスで構成されている
- プラクティスの相互作用により、メソッドは単なるプラクティスの集合以上のものとなっている


### XPのプラクティス概要

### 2.1.1 チームメンバーとしての顧客
顧客と開発者は親密に仕事をするのが望ましい。お互いに相手の問題を把握できるし、その問題の解決に一緒に取り組むことができる

#### 顧客の定義
- 仕様の定義とその優先順の決定権を持つ個人またはグループ
- 開発者と同じ会社に属するビジネス分析の専門家やマーケティングの専門家が顧客の場合も
- ユーザーから依頼を受けた代理人が顧客の場合も
- 実際に報酬を支払う人が顧客の場合も
- 顧客と開発者が同じ部屋で仕事をするのが理想的。30m以上離れない方が良い
- それが無理ならば、積極的に一緒に仕事をしてくれる顧客の代役を立てるのが望ましい


### ユーザーストーリー
プロジェクトの計画を練るために、仕様要求の詳細を知っている必要はない。仕様要求は常に変化していくから。

#### XPでは
- 顧客と話し合うことで、仕様要求の概略をつかむ
- 仕様要求の詳細を詰めることはしない


#### ユーザーストーリーの作成
- 顧客はインデックスカードにお互いが同意した内容を簡単に書き留める
- 後で会話の内容が思い出せる程度のものでOK
- 開発者は、そのカードにだいたいの時間の見積もりを記入。
- 時間は、顧客との交渉中に感じ取った大雑把な感覚に基づいたものでいい
- ユーザーストーリーが、仕様要求に関する話し合いの覚書であると同時にプランニングツールになる
- 顧客はユーザーストーリー使って優先順位と評価コストを考慮しながら、どの機能をどのタイミングでシステムに組み込むかというスケジュールを立てる


### 短期間のリリースサイクル

#### イテレーションプラン
- イテレーション期間は通常、２週間
- イテレーションごとに小さな機能をいくつか実装して納品する
- それらが最終製品に組み込まれるかは決定していない
- 開発者が作成した見積もりをベースに顧客が複数のユーザーストーリーを選び、それらが実装される
- 開発者は前回のイテレーションでこなした仕事量を参考にして、次回のイテレーションでの仕事を見積もる
- 顧客は、その見積もりを超えない範囲内で、ストーリーを好きな数だけ選択できる
- イテレーションがスタートしたら、顧客はそのイテレーションでのストーリや作業の優先順位を変えないことに同意する
- イテレーション期間中、開発者たちは自由にストーリをタスクレベルに分割し、技術的にもビジネスの面からも最も合理的な順序でそれぞれのタスクを実装することが許されている


#### リリースプラン
- ６回分のイテレーションを一つにまとめたプランを作成
- 通常、１回のリリースには３ヶ月程度かかり、製品に組み込めるような本格的なソフトウェアのリリース
- 見積もりをベースに顧客が優先順位をつけて選択したユーザーストーリーを寄せ集めて構築
- 開発者は、前回のリリースの作業量から、次回の作業量を見積もる
- 顧客は見積もり範囲内で、リリースに組み込みたいストーリーを選択できる
- リリースで実装したいストーリーの優先順位を決めるのも顧客
- 必要であれば、リリース初期段階では、開発者が顧客に提案しても良い
- 顧客はいつでもリリースの内容を変更できる
- 顧客はストーリーのキャンセル、追加、優先順位の変更が可能


### 2.1.4 受け入れテスト
- ユーザーストーリーの詳細は、顧客が提示する `受け入れテスト` の書式で記述される
- ストーリーの受け入れテストは、そのストーリーの実装直前か、実装と並行して作られる
- 受け入れテストは自動的に繰り返して実行できるようにある種のスクリプト言語で書かれる
- 自動的に繰り返し行うことで、システムが顧客の要求通りに動くかどうかをチェックできる

### 2.1.5 ペアプログラミング
- ペアの毎日組み替えることで、チーム内に劇的に知識が広まる
- ペアを組むことでプログラマーの作業効率が落ちることはなく、欠陥率は著しく減少する

### 2.1.6 テストファーストの開発
- コードは失敗するユニットテストをパスさせる目的で書かれる
- 先にテストを書き、その後、それをパスできるコードを書く
- テストをパスさせる目的でコードを書くのだから、そのコードはテスト可能なものとなる
- 個別でテストできるようにモジュールに分割させたい強い動機が生まれる
- この方法で設計されたコードは、独立性の高いものとなる


### 2.1.7 共同所有権
- 共同作業しているペアには、どんなモジュールでもチェックし、かつ、それを改善する権利がある。
- 自分の専門分野があれば、主にその担当になることはあるば、第二分野を持つこともできる


### 2.1.8 継続的なインテグレーション(統合)
- 担当しているコードを１日に数回チェックインしながら進める
- 先にチェックインしたものが勝ち、他の者はマージする


### 2.1.9 持続可能なペース
- 節度を持った一定のペースで進める
- 残業はしないが、リリース最終週で、後少しで完成できる場合は例外

### 2.1.10 オープンワークスペース
- チームはオープンな部屋でともに作業する
- 別のペアが困っているのに気づける広さ
- 気が散るように思えるが、作業効率は２倍になる調査結果

### 2.1.11 計画ゲーム
- ビジネス側と開発側の責任の切り分け
- ビジネス側(顧客)は、各機能のビジネス的な重要度を決定し、開発者側はその機能を組み込むための必要なコストを見積もる

### 2.1.12 シンプルな設計
- MVPの実装に留める
- あとで絶対に必要になるものだけをあらかじめ用意する
- コードをDRYに保つ

### 2.1.13 リファクタリング
- リファクタリングを頻繁に行うことで、アーキテクチャを常に健全に保つ
- 今日書いた乱雑なコードは、今日のうちに直す


# テスティング

## 4.1 テスト主導型の開発

### 4.1.2 テストの分離


